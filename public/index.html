<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birria Fusion - Food Truck Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --orange: #ff6b35;
            --orange-dark: #e55a2b;
            --charcoal: #2c2c2c;
            --white: #ffffff;
            --gray: #666666;
            --gray-light: #f8f8f8;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --border: #e0e0e0;
        }

        [data-theme="dark"] {
            --white: #1a1a1a;
            --gray-light: #2c2c2c;
            --charcoal: #ffffff;
            --gray: #cccccc;
            --border: #404040;
        }

        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap');

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--white);
            color: var(--charcoal);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--orange) 0%, var(--orange-dark) 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(255, 107, 53, 0.3);
        }

        .header-content {
            display: flex;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            gap: 20px;
        }

        .logo {
            width: 80px;
            height: 80px;
            border-radius: 15px;
            background: rgba(255,255,255,0.2);
            padding: 5px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            white-space: nowrap;
        }

        .hamburger-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            backdrop-filter: blur(10px);
        }

        .hamburger-btn:hover {
            background: var(--orange-dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 100px;
        }

        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            border-top: 1px solid var(--border);
            padding: 15px 0;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .nav-items {
            display: flex;
            justify-content: space-around;
            max-width: 600px;
            margin: 0 auto;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 12px 8px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--gray);
            font-size: 12px;
            font-weight: 600;
            background: none;
            border: none;
            min-width: 60px;
        }

        .nav-item:hover,
        .nav-item.active {
            color: var(--orange);
            background: rgba(255, 107, 53, 0.1);
        }

        .nav-icon {
            width: 22px;
            height: 22px;
            flex-shrink: 0;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .section {
            background: var(--white);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        #settings .section {
            padding: 10px;
            margin-bottom: 5px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--charcoal);
            border-bottom: 2px solid var(--orange);
            padding-bottom: 10px;
        }

        .form {
            max-width: 600px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--orange);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .btn {
            background: var(--orange);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .btn:hover {
            background: var(--orange-dark);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-secondary {
            background: var(--charcoal);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.2s ease;
            color: var(--charcoal);
        }
        
        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }
        
        .file-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .file-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: var(--orange);
        }
        
        .file-thumbnail {
            width: 50px;
            height: 50px;
            margin: 0 auto 8px;
            border-radius: 6px;
            object-fit: cover;
        }
        
        .file-icon {
            width: 50px;
            height: 50px;
            margin: 0 auto 8px;
            background: var(--orange);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8em;
        }
        
        .file-name {
            font-size: 0.85em;
            font-weight: 600;
            margin-bottom: 4px;
            word-break: break-word;
            line-height: 1.2;
        }
        
        .file-meta {
            font-size: 0.7em;
            color: var(--gray);
            margin-bottom: 8px;
        }
        
        .file-actions {
            display: flex;
            gap: 4px;
            justify-content: center;
        }
        
        .file-actions .btn {
            padding: 4px 8px;
            font-size: 0.7em;
            width: auto;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-color: var(--orange);
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--charcoal);
        }

        .card-meta {
            color: var(--gray);
            font-size: 13px;
            margin-bottom: 6px;
        }

        .card-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .card-actions .btn {
            padding: 6px 12px;
            font-size: 13px;
            width: auto;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            color: var(--charcoal);
        }

        .stat-number {
            font-size: 36px;
            font-weight: 800;
            color: var(--orange);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 14px;
        }

        .extra-menu {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 5px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .extra-menu.show {
            display: flex;
        }

        .extra-menu button {
            background: none;
            border: none;
            padding: 12px 16px;
            text-align: left;
            cursor: pointer;
            border-radius: 8px;
            color: var(--charcoal);
            font-size: 14px;
            white-space: nowrap;
        }

        .extra-menu button:hover {
            background: var(--orange);
            color: white;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--orange);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .settings-content {
            display: none;
            margin-top: 5px;
        }

        .settings-content .form {
            margin: 0;
        }

        .settings-content .form-group {
            margin-bottom: 5px;
        }

        .settings-content .form-row {
            margin-bottom: 5px;
        }

        .settings-content.show {
            display: block;
        }

        .fab {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: #ff6b35 !important;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
            z-index: 999;
            transition: all 0.2s ease;
        }

        .fab:hover {
            background: #e55a2b !important;
            transform: scale(1.1);
        }
        
        #fabBtn {
            background: #ff6b35 !important;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--charcoal);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <img src="/uploads/1763192867406_birria-fusion-logo.png" alt="Logo" class="logo">
            <h1>Birria Fusion</h1>
            <button class="hamburger-btn" onclick="showPage('settings')">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
    </div>

    <div class="container">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <div class="section">
                <h2 class="section-title">Business Overview</h2>
                <div class="stats" id="dashboardStats"></div>
            </div>

            <div class="section">
                <h2 class="section-title">Top Items by Food Cost</h2>
                <div class="grid" id="topItems"></div>
            </div>
        </div>

        <!-- Menu Page -->
        <div id="menu" class="page">


            <div class="section">
                <h2 class="section-title">Menu Items</h2>
                <div class="grid" id="menuItems"></div>
            </div>
        </div>

        <!-- Ingredients Page -->
        <div id="ingredients" class="page">


            <div class="section">
                <h2 class="section-title">Ingredients</h2>
                <div class="grid" id="ingredientsList"></div>
            </div>
        </div>

        <!-- Inventory Page -->
        <div id="inventory" class="page">


            <div class="section">
                <h2 class="section-title">Current Inventory</h2>
                <div class="grid" id="inventoryList"></div>
            </div>
        </div>

        <!-- Suppliers Page -->
        <div id="suppliers" class="page">


            <div class="section">
                <h2 class="section-title">Suppliers</h2>
                <div class="grid" id="suppliersList"></div>
            </div>
        </div>

        <!-- Tools Page -->
        <div id="tools" class="page">
            <div class="section">
                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; font-size: 1.2em;">üìú License Renewals</h3>
                    <button class="btn" onclick="addLicense()" style="padding: 8px 16px; font-size: 0.9em; width: auto;">Add License</button>
                </div>
                <div class="files-grid" id="licenseList"></div>
            </div>
            
            <div class="section">
                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; font-size: 1.2em;">üìÖ Maintenance Schedule</h3>
                    <button class="btn" onclick="addMaintenanceTask()" style="padding: 8px 16px; font-size: 0.9em; width: auto;">Add Task</button>
                </div>
                <div class="files-grid" id="maintenanceList"></div>
            </div>
            
            <div class="section">
                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; font-size: 1.2em;">üì± QR Code Generator</h3>
                </div>
                <div class="form" style="max-width: 500px;">
                    <div class="form-group">
                        <select id="qrType" onchange="updateQRPlaceholder()">
                            <option value="url">Website/Menu Link</option>
                            <option value="text">Text Message</option>
                            <option value="phone">Phone Number</option>
                            <option value="email">Email Address</option>
                            <option value="wifi">WiFi Network</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <input type="text" id="qrContent" placeholder="Enter URL or text">
                    </div>
                    <div id="wifiFields" style="display: none;">
                        <div class="form-row">
                            <input type="text" id="wifiSSID" placeholder="Network Name (SSID)">
                            <input type="password" id="wifiPassword" placeholder="Password">
                        </div>
                    </div>
                    <button class="btn" onclick="generateQR()" style="width: auto; padding: 12px 24px;">Generate QR Code</button>
                </div>
                <div id="qrResult" style="text-align: center; margin-top: 20px;"></div>
            </div>
            
            <div class="section">
                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; font-size: 1.2em;">üìÅ Files</h3>
                    <button class="btn" onclick="document.getElementById('fileUpload').click()" style="padding: 8px 16px; font-size: 0.9em; width: auto;">
                        <i class="fas fa-upload"></i> Upload
                    </button>
                </div>
                <input type="file" id="fileUpload" style="display: none;" multiple accept="image/*,.pdf,.doc,.docx" onchange="uploadFileFromSection()">
                <div class="files-grid" id="filesList"></div>
            </div>
        </div>

        <!-- Catering Page -->
        <div id="catering" class="page">
            <div class="section">
                <h2 class="section-title">Upcoming Orders</h2>
                <div class="grid" id="cateringList"></div>
            </div>
            
            <div class="section">
                <h2 class="section-title">Equipment & Rentals</h2>
                <div class="grid" id="toolsList"></div>
            </div>
        </div>

        <!-- Analytics Page -->
        <div id="analytics" class="page">
            <div class="section">
                <h2 class="section-title">Food Cost Analysis</h2>
                <div class="stats" id="analyticsStats"></div>
            </div>
            <div class="section">
                <h2 class="section-title">Detailed Analysis</h2>
                <div class="grid" id="foodCostAnalysis"></div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page">
            <div class="section">
                <h2 class="section-title" onclick="toggleSettingsSection('theme')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                    Theme Settings
                    <span id="theme-icon">‚ñº</span>
                </h2>
                <div id="theme-content" class="settings-content">
                    <div class="form">
                        <div class="form-group">
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="font-size: 16px; font-weight: 500;">Dark Mode</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="darkMode" onchange="toggleTheme()">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title" onclick="toggleSettingsSection('business')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                    Business Information
                    <span id="business-icon">‚ñº</span>
                </h2>
                <div id="business-content" class="settings-content">
                    <div class="form">
                        <div class="form-group">
                            <input type="text" id="truckName" placeholder="Food Truck Name" value="Birria Fusion">
                        </div>
                        <div class="form-group">
                            <label for="defaultMargin" style="display: block; margin-bottom: 5px; font-weight: 500; color: var(--charcoal);">Default Margin Percentage</label>
                            <input type="number" id="defaultMargin" placeholder="Default Margin %" min="0" max="100" step="0.1" onchange="saveDefaultMargin()">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title" onclick="toggleSettingsSection('menuCategories')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                    Menu Categories
                    <span id="menuCategories-icon">‚ñº</span>
                </h2>
                <div id="menuCategories-content" class="settings-content">
                    <div class="form">
                        <div class="form-row">
                            <input type="text" id="newCategory" placeholder="Add new category (e.g., Appetizers, Mains)">
                            <button class="btn" onclick="addMenuCategory()" style="width: auto; padding: 12px 20px;">Add Category</button>
                        </div>
                        <div id="categoriesList" style="margin-top: 15px;"></div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title" onclick="toggleSettingsSection('supplierCategories')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                    Supplier Categories
                    <span id="supplierCategories-icon">‚ñº</span>
                </h2>
                <div id="supplierCategories-content" class="settings-content">
                    <div class="form">
                        <div class="form-row">
                            <input type="text" id="newSupplierCategory" placeholder="Add new supplier category (e.g., Produce, Equipment)">
                            <button class="btn" onclick="addSupplierCategory()" style="width: auto; padding: 12px 20px;">Add Category</button>
                        </div>
                        <div id="supplierCategoriesList" style="margin-top: 15px;"></div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title" onclick="toggleSettingsSection('units')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                    Measurement Units
                    <span id="units-icon">‚ñº</span>
                </h2>
                <div id="units-content" class="settings-content">
                    <div class="form">
                        <div class="form-row">
                            <input type="text" id="newUnit" placeholder="Add new unit (e.g., cups, tbsp)">
                            <button class="btn" onclick="addMeasurementUnit()" style="width: auto; padding: 12px 20px;">Add Unit</button>
                        </div>
                        <div id="unitsList" style="margin-top: 15px;"></div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title" onclick="toggleSettingsSection('data')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                    Data Management
                    <span id="data-icon">‚ñº</span>
                </h2>
                <div id="data-content" class="settings-content">
                    <div class="form">
                        <div class="form-row">
                            <button class="btn" onclick="exportData()" style="background: var(--success);">Export Data</button>
                            <button class="btn btn-danger" onclick="clearData()">Clear All Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="fab" onclick="openAddModal()" id="fabBtn" title="Add new item" style="background: #ff6b35 !important; color: white !important;">+</button>

    <!-- Add Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Add Item</h3>
                <button class="close-btn" onclick="closeAddModal()">&times;</button>
            </div>
            <div id="modalForm"></div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="editModalTitle">Edit Item</h3>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="form">
                <div class="form-group">
                    <input type="text" id="editInput" placeholder="Enter name">
                </div>
                <div class="form-row">
                    <button class="btn" onclick="saveEdit()" style="background: var(--orange);">Save</button>
                    <button class="btn btn-danger" onclick="deleteItem()" style="background: var(--danger);">Delete</button>
                    <button class="btn btn-secondary" onclick="closeEditModal()" style="background: #666666 !important; color: white !important;">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <nav class="nav">
        <div class="nav-items">
            <button class="nav-item active" onclick="showPage('dashboard')">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                </svg>
                <span>Dashboard</span>
            </button>
            <button class="nav-item" onclick="showPage('menu')">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3 7h14l-1-1H4l-1 1zm0 2h14v8a1 1 0 01-1 1H4a1 1 0 01-1-1V9zm2-4h10a1 1 0 011 1H4a1 1 0 011-1z"/>
                </svg>
                <span>Menu</span>
            </button>
            <button class="nav-item" onclick="showPage('ingredients')">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 2L3 7v11a1 1 0 001 1h12a1 1 0 001-1V7l-7-5zM6 9.5a.5.5 0 01.5-.5h7a.5.5 0 010 1h-7a.5.5 0 01-.5-.5zm0 2a.5.5 0 01.5-.5h7a.5.5 0 010 1h-7a.5.5 0 01-.5-.5z"/>
                </svg>
                <span>Ingredients</span>
            </button>
            <button class="nav-item" onclick="showPage('inventory')">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M4 3a2 2 0 100 4h12a2 2 0 100-4H4zM3 8a1 1 0 000 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a1 1 0 100-2H3zm8 6a1 1 0 11-2 0 1 1 0 012 0z"/>
                </svg>
                <span>Inventory</span>
            </button>
            <button class="nav-item" onclick="showPage('suppliers')">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"/>
                    <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"/>
                </svg>
                <span>Suppliers</span>
            </button>
            <button class="nav-item" onclick="toggleExtraMenu()">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
                </svg>
                <span>More</span>
            </button>
        </div>
        
        <div class="extra-menu" id="extraMenu">
            <button onclick="showPage('tools')">Tools</button>
            <button onclick="showPage('catering')">Catering</button>
            <button onclick="showPage('analytics')">Analytics</button>
        </div>
    </nav>

    <script>
        let currentPage = 'dashboard';

        // Page Navigation
        function showPage(pageId) {
            currentPage = pageId;
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            const navItem = document.querySelector(`[onclick*="${pageId}"]`);
            if (navItem && navItem.classList.contains('nav-item')) {
                navItem.classList.add('active');
            }
            
            document.getElementById('extraMenu').classList.remove('show');
            
            // Show/hide FAB based on page
            const fabBtn = document.getElementById('fabBtn');
            if (['dashboard', 'analytics', 'settings'].includes(pageId)) {
                fabBtn.style.display = 'none';
            } else {
                fabBtn.style.display = 'block';
                fabBtn.style.background = '#ff6b35';
            }
            
            if (pageId === 'dashboard') loadDashboard();
            if (pageId === 'menu') loadMenu();
            if (pageId === 'ingredients') loadIngredients();
            if (pageId === 'inventory') loadInventory();
            if (pageId === 'suppliers') loadSuppliers();
            if (pageId === 'tools') { loadFiles(); loadLicenses(); loadMaintenanceTasks(); }
            if (pageId === 'catering') { loadCatering(); loadTools(); }
            if (pageId === 'analytics') loadAnalytics();
            if (pageId === 'settings') { loadMeasurementUnits(); loadMenuCategories(); loadSupplierCategories(); loadDefaultMargin(); }
        }

        // Modal Functions
        function openAddModal() {
            const modal = document.getElementById('addModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalForm = document.getElementById('modalForm');
            
            let title = '';
            let form = '';
            
            switch(currentPage) {
                case 'menu':
                    title = 'Add New Recipe';
                    form = `
                        <div class="form">
                            <div class="form-group">
                                <input type="text" id="recipeName" placeholder="Recipe Name (e.g., Birria Tacos)">
                            </div>
                            <div class="form-row">
                                <select id="recipeType">
                                    ${getAllMenuCategories().map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                                </select>
                                <input type="number" id="portions" placeholder="Portions" min="1" value="1">
                            </div>
                            <div class="form-row">
                                <input type="number" id="price" placeholder="Menu Price ($)" step="0.01">
                                <input type="number" id="cost" placeholder="Recipe Cost ($)" step="0.01">
                            </div>
                            <button class="btn" onclick="addRecipe(); closeAddModal();">Add Recipe</button>
                        </div>
                    `;
                    break;
                case 'ingredients':
                    title = 'Add Ingredient';
                    const units = getAllMeasurementUnits();
                    const unitOptions = units.map(unit => `<option value="${unit}">${unit}</option>`).join('');
                    form = `
                        <div class="form">
                            <div class="form-group">
                                <input type="text" id="ingredientName" placeholder="Ingredient Name (e.g., Ground Beef)">
                            </div>
                            <div class="form-row">
                                <input type="number" id="ingredientCost" placeholder="Cost per Unit ($)" step="0.01">
                                <select id="ingredientUnit">
                                    <option value="">Select unit...</option>
                                    ${unitOptions}
                                </select>
                            </div>
                            <div class="form-group">
                                <input type="number" id="ingredientServings" placeholder="Servings" min="1">
                            </div>
                            <button class="btn" onclick="addIngredient(); closeAddModal();">Add Ingredient</button>
                        </div>
                    `;
                    break;
                case 'inventory':
                    title = 'Add to Inventory';
                    form = `
                        <div class="form">
                            <div class="form-group">
                                <input type="text" id="inventoryItemName" placeholder="Item Name (e.g., Paper Towels, Ground Beef)">
                            </div>
                            <div class="form-row">
                                <select id="inventoryCategory">
                                    <option value="Food">Food</option>
                                    <option value="Cleaning Supplies">Cleaning Supplies</option>
                                    <option value="To Go Supplies">To Go Supplies</option>
                                    <option value="Equipment">Equipment</option>
                                    <option value="Other">Other</option>
                                </select>
                                <select id="inventoryUnit">
                                    <option value="">Select unit...</option>
                                    ${getAllMeasurementUnits().map(unit => `<option value="${unit}">${unit}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-row">
                                <input type="number" id="currentStock" placeholder="Current Stock" step="0.1">
                                <input type="number" id="minStock" placeholder="Min Stock" step="0.1">
                            </div>
                            <button class="btn" onclick="addInventoryItem(); closeAddModal();">Add to Inventory</button>
                        </div>
                    `;
                    break;
                case 'suppliers':
                    title = 'Add Supplier';
                    form = `
                        <div class="form">
                            <div class="form-group">
                                <input type="text" id="supplierName" placeholder="Supplier Name">
                            </div>
                            <div class="form-row">
                                <input type="text" id="supplierContact" placeholder="Contact Person">
                                <select id="supplierCategory">
                                    ${getAllSupplierCategories().map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-row">
                                <input type="tel" id="supplierPhone" placeholder="Phone Number">
                                <input type="email" id="supplierEmail" placeholder="Email">
                            </div>
                            <div class="form-group">
                                <input type="text" id="supplierAddress" placeholder="Address">
                            </div>
                            <div class="form-group">
                                <textarea id="supplierDescription" placeholder="Description, notes, terms..." rows="3"></textarea>
                            </div>
                            <button class="btn" onclick="addSupplier(); closeAddModal();">Add Supplier</button>
                        </div>
                    `;
                    break;
                case 'tools':
                    title = 'Add Tool or Upload File';
                    form = `
                        <div class="form">
                            <h4 style="margin-bottom: 15px;">Add Tool</h4>
                            <div class="form-group">
                                <input type="text" id="toolName" placeholder="Tool/Equipment Name">
                            </div>
                            <div class="form-row">
                                <select id="toolCategory">
                                    <option value="Cooking">Cooking Equipment</option>
                                    <option value="Prep">Prep Tools</option>
                                    <option value="Storage">Storage</option>
                                    <option value="Cleaning">Cleaning</option>
                                </select>
                                <select id="toolStatus">
                                    <option value="Working">Working</option>
                                    <option value="Maintenance">Needs Maintenance</option>
                                    <option value="Broken">Broken</option>
                                </select>
                            </div>
                            <button class="btn" onclick="addTool(); closeAddModal();">Add Tool</button>
                            
                            <hr style="margin: 20px 0;">
                            
                            <h4 style="margin-bottom: 15px;">Upload File</h4>
                            <div class="form-group">
                                <input type="file" id="fileUpload" multiple accept="image/*,.pdf,.doc,.docx">
                            </div>
                            <button class="btn" onclick="uploadFile(); closeAddModal();">Upload File</button>
                        </div>
                    `;
                    break;
                case 'catering':
                    title = 'Add Catering Order';
                    form = `
                        <div class="form">
                            <div class="form-row">
                                <input type="text" id="cateringClient" placeholder="Client Name">
                                <input type="date" id="cateringDate">
                            </div>
                            <div class="form-row">
                                <input type="number" id="cateringGuests" placeholder="Number of Guests" min="1">
                                <input type="number" id="cateringPrice" placeholder="Total Price ($)" step="0.01">
                            </div>
                            <button class="btn" onclick="addCateringOrder(); closeAddModal();">Add Catering Order</button>
                        </div>
                    `;
                    break;
            }
            
            modalTitle.textContent = title;
            modalForm.innerHTML = form;
            
            // Load ingredients for inventory dropdown if needed
            if (currentPage === 'inventory') {
                setTimeout(() => {
                    fetch('/api/ingredients')
                        .then(r => r.json())
                        .then(ingredients => {
                            const inventorySelect = document.getElementById('inventoryIngredient');
                            if (inventorySelect) {
                                inventorySelect.innerHTML = 
                                    '<option value="">Select ingredient...</option>' +
                                    ingredients.map(ing => `<option value="${ing.id}">${ing.name} (${ing.unit})</option>`).join('');
                            }
                        });
                }, 100);
            }
            
            modal.classList.add('show');
        }
        
        function closeAddModal() {
            document.getElementById('addModal').classList.remove('show');
        }

        // Extra Menu
        function toggleExtraMenu() {
            document.getElementById('extraMenu').classList.toggle('show');
        }

        document.addEventListener('click', function(event) {
            const menu = document.getElementById('extraMenu');
            const btn = event.target.closest('[onclick="toggleExtraMenu()"]');
            if (!menu.contains(event.target) && !btn) {
                menu.classList.remove('show');
            }
        });

        // Dashboard Functions
        function loadDashboard() {
            fetch('/api/menu')
                .then(r => r.json())
                .then(items => {
                    const totalItems = items.length;
                    const avgFoodCost = totalItems > 0 ? items.reduce((sum, item) => sum + ((item.cost / item.price) * 100), 0) / totalItems : 0;
                    const defaultMargin = parseFloat(localStorage.getItem('defaultMargin') || '30');
                    const goodItems = items.filter(item => ((item.price - item.cost) / item.price) * 100 >= defaultMargin).length;
                    const totalRevenue = items.reduce((sum, item) => sum + (item.price * 10), 0);

                    document.getElementById('dashboardStats').innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number">${totalItems}</div>
                            <div class="stat-label">Menu Items</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${avgFoodCost.toFixed(1)}%</div>
                            <div class="stat-label">Avg Food Cost</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${goodItems}</div>
                            <div class="stat-label">Good Items (30%+)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">$${totalRevenue.toFixed(0)}</div>
                            <div class="stat-label">Est. Revenue</div>
                        </div>
                    `;

                    const topItems = items.sort((a, b) => (b.cost / b.price) - (a.cost / a.price)).slice(0, 6);
                    document.getElementById('topItems').innerHTML = topItems.map(item => {
                        const foodCost = (item.cost / item.price) * 100;
                        const defaultMargin = parseFloat(localStorage.getItem('defaultMargin') || '30');
                        const margin = ((item.price - item.cost) / item.price) * 100;
                        const status = margin >= defaultMargin ? 'üü¢ Good' : margin >= (defaultMargin * 0.67) ? 'üü° Needs Attention' : 'üî¥ Bad - Urgent';
                        return `
                            <div class="card">
                                <div class="card-title">${item.name}</div>
                                <div class="card-meta">$${item.price} ‚Ä¢ ${foodCost.toFixed(1)}% food cost</div>
                                <div class="card-meta">${status}</div>
                            </div>
                        `;
                    }).join('');
                });
        }

        // Menu Functions
        function addRecipe() {
            const name = document.getElementById('recipeName').value;
            const type = document.getElementById('recipeType').value;
            const portions = parseInt(document.getElementById('portions').value) || 1;
            const price = parseFloat(document.getElementById('price').value);
            const cost = parseFloat(document.getElementById('cost').value);

            if (!name || !price || !cost) {
                alert('Please fill in all fields');
                return;
            }

            fetch('/api/menu', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, price, cost, recipe_type: type, portions })
            }).then(() => {
                document.getElementById('recipeName').value = '';
                document.getElementById('price').value = '';
                document.getElementById('cost').value = '';
                document.getElementById('portions').value = '1';
                loadMenu();
            });
        }

        function loadMenu() {
            fetch('/api/menu')
                .then(r => r.json())
                .then(items => {
                    // Group items by category
                    const grouped = {};
                    items.forEach(item => {
                        const category = item.recipe_type || 'Uncategorized';
                        if (!grouped[category]) grouped[category] = [];
                        grouped[category].push(item);
                    });
                    
                    let html = '';
                    Object.keys(grouped).sort().forEach(category => {
                        html += `<div style="grid-column: 1 / -1; margin: 20px 0 10px 0;"><h3 style="color: var(--orange); font-size: 18px; font-weight: 600; border-bottom: 2px solid var(--orange); padding-bottom: 8px;">${category}</h3></div>`;
                        
                        grouped[category].forEach(item => {
                            const margin = ((item.price - item.cost) / item.price) * 100;
                            const status = margin >= 30 ? 'üü¢ Good' : margin >= 20 ? 'üü° Needs Attention' : 'üî¥ Bad - Urgent';
                            html += `
                                <div class="card">
                                    <div class="card-header" onclick="toggleMenuDetails(${item.id})" style="cursor: pointer;">
                                        <div class="card-title" style="display: flex; justify-content: space-between; align-items: center;">
                                            ${item.name}
                                            <span class="expand-icon" id="icon-${item.id}">‚ñº</span>
                                        </div>
                                        <div class="card-meta">${item.recipe_type || 'Uncategorized'} ‚Ä¢ ${item.portions} portions</div>
                                        <div class="card-meta" style="display: flex; gap: 15px; align-items: center;">
                                            <span>Cost: $${item.cost.toFixed(2)}</span>
                                            <span style="display: flex; align-items: center;">Price: $<input type="number" class="inline-edit-input" value="${item.price.toFixed(2)}" step="0.01" min="0" onchange="updatePrice(${item.id}, this.value)" style="width: 70px; padding: 4px; border: 1px solid var(--border); border-radius: 4px; background: var(--white); color: var(--charcoal); margin-left: 2px;" onclick="event.stopPropagation();"></span>
                                        </div>
                                        <div class="card-meta">Margin: <input type="number" class="inline-edit-input" value="${margin.toFixed(1)}" step="0.1" min="0" max="100" onchange="updateMargin(${item.id}, this.value)" style="width: 50px; padding: 4px; border: 1px solid var(--border); border-radius: 4px; background: var(--white); color: var(--charcoal);" onclick="event.stopPropagation();">% ${status}</div>
                                    </div>
                                    <div class="card-details" id="details-${item.id}" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border);">
                                        <h4 style="margin-bottom: 10px;">Ingredients:</h4>
                                        <div id="ingredients-${item.id}">Loading ingredients...</div>
                                    </div>
                                    <div class="card-actions" style="display: flex; gap: 10px; margin-top: 15px;">
                                        <button class="btn" onclick="event.stopPropagation(); editRecipe(${item.id})" style="flex: 1; background: var(--orange); color: white;">Edit</button>
                                        <button class="btn btn-danger" onclick="event.stopPropagation(); deleteRecipe(${item.id})" style="flex: 1;">Delete</button>
                                    </div>
                                </div>
                            `;
                        });
                    });
                    
                    document.getElementById('menuItems').innerHTML = html;
                });
        }

        function toggleMenuDetails(id) {
            const details = document.getElementById(`details-${id}`);
            const icon = document.getElementById(`icon-${id}`);
            
            if (details.style.display === 'none') {
                details.style.display = 'block';
                icon.textContent = '‚ñ≤';
                loadMenuIngredients(id);
            } else {
                details.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }
        
        function loadMenuIngredients(menuId) {
            const ingredients = JSON.parse(localStorage.getItem(`recipe-${menuId}`) || '[]');
            
            if (ingredients.length === 0) {
                document.getElementById(`ingredients-${menuId}`).innerHTML = '<div style="color: var(--gray); font-style: italic;">No ingredients added yet. Use Edit to add ingredients.</div>';
                return;
            }
            
            const ingredientsHtml = ingredients.map(ing => `
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding: 8px; background: var(--gray-light); border-radius: 6px;">
                    <span>${ing.name}</span>
                    <span>${ing.amount} servings - $${(ing.calculatedCost || 0).toFixed(2)}</span>
                </div>
            `).join('');
            
            document.getElementById(`ingredients-${menuId}`).innerHTML = ingredientsHtml;
        }

        function editRecipe(id) {
            editingRecipeId = id;
            editIngredients = JSON.parse(localStorage.getItem(`recipe-${id}`) || '[]');
            
            // Get recipe data
            fetch('/api/menu')
                .then(r => r.json())
                .then(items => {
                    const recipe = items.find(item => item.id === id);
                    if (!recipe) return;
                    
                    // Open modal with edit form
                    const modal = document.getElementById('addModal');
                    const modalTitle = document.getElementById('modalTitle');
                    const modalForm = document.getElementById('modalForm');
                    
                    modalTitle.textContent = 'Edit Recipe';
                    const ingredients = JSON.parse(localStorage.getItem(`recipe-${id}`) || '[]');
                    
                    modalForm.innerHTML = `
                        <div class="form">
                            <div class="form-group">
                                <input type="text" id="recipeName" placeholder="Recipe Name" value="${recipe.name}">
                            </div>
                            <div class="form-row">
                                <select id="recipeType">
                                    ${getAllMenuCategories().map(cat => `<option value="${cat}" ${recipe.recipe_type === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                                </select>
                                <input type="number" id="portions" placeholder="Portions" min="1" value="${recipe.portions}">
                            </div>
                            <div class="form-row">
                                <input type="number" id="price" placeholder="Menu Price ($)" step="0.01" value="${recipe.price}">
                                <input type="number" id="cost" placeholder="Recipe Cost ($)" step="0.01" value="${ingredients.reduce((sum, ing) => sum + (ing.calculatedCost || 0), 0).toFixed(2)}" readonly style="background: var(--gray-light);">
                            </div>
                            
                            <h4 style="margin: 20px 0 10px 0;">Ingredients</h4>
                            <div id="editIngredientsList">
                                ${ingredients.map((ing, index) => `
                                    <div class="form-row" style="align-items: center; margin-bottom: 10px;">
                                        <select onchange="updateEditIngredient(${index}, 'ingredientId', this.value); calculateIngredientCost(${index})" style="flex: 1;">
                                            <option value="">Select ingredient...</option>
                                            <option value="${ing.ingredientId || ''}" selected>${ing.name || 'Select ingredient...'}</option>
                                        </select>
                                        <input type="number" placeholder="Servings" step="0.1" value="${ing.amount}" onchange="updateEditIngredient(${index}, 'amount', this.value); calculateIngredientCost(${index})" style="width: 80px;">
                                        <span style="width: 80px; text-align: center; font-size: 12px;">$${(ing.calculatedCost || 0).toFixed(2)}</span>
                                        <button type="button" onclick="removeEditIngredient(${index})" style="background: var(--danger); color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer;">&times;</button>
                                    </div>
                                `).join('')}
                            </div>
                            <div style="text-align: right; margin: 10px 0; font-weight: bold;">Total Cost: $<span id="totalCost">${ingredients.reduce((sum, ing) => sum + (ing.calculatedCost || 0), 0).toFixed(2)}</span></div>
                            <button type="button" class="btn" onclick="addEditIngredient()" style="background: var(--success); margin-bottom: 15px;">+ Add Ingredient</button>
                            
                            <button class="btn" onclick="updateRecipe(${id}); closeAddModal();">Update Recipe</button>
                        </div>
                    `;
                    
                    modal.classList.add('show');
                });
        }
        
        function updateRecipe(id) {
            const name = document.getElementById('recipeName').value;
            const type = document.getElementById('recipeType').value;
            const portions = parseInt(document.getElementById('portions').value) || 1;
            const price = parseFloat(document.getElementById('price').value);
            
            let sum = 0;
            editIngredients.forEach(ing => {
                sum += Math.round((ing.calculatedCost || 0) * 100);
            });
            const cost = sum / 100;

            if (!name || !price) {
                alert('Please fill in name and price');
                return;
            }
            
            localStorage.setItem(`recipe-${id}`, JSON.stringify(editIngredients));

            fetch(`/api/menu/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, price, cost, recipe_type: type, portions })
            }).then(() => {
                setTimeout(() => loadMenu(), 200);
            });
        }

        function deleteRecipe(id) {
            if (confirm('Delete this recipe?')) {
                fetch(`/api/menu/${id}`, { method: 'DELETE' })
                    .then(() => loadMenu());
            }
        }

        function updatePrice(id, newPrice) {
            const price = parseFloat(newPrice);
            if (isNaN(price) || price <= 0) return;
            
            // Get current item to preserve other fields
            fetch('/api/menu')
                .then(r => r.json())
                .then(items => {
                    const item = items.find(i => i.id === id);
                    if (!item) return;
                    
                    fetch(`/api/menu/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            name: item.name,
                            price: price,
                            cost: item.cost,
                            recipe_type: item.recipe_type,
                            portions: item.portions
                        })
                    }).then(() => {
                        loadMenu();
                    });
                });
        }

        function updateMargin(id, newMargin) {
            const margin = parseFloat(newMargin);
            if (isNaN(margin) || margin < 0) return;
            
            // Get current item data to calculate new price
            fetch('/api/menu')
                .then(r => r.json())
                .then(items => {
                    const item = items.find(i => i.id === id);
                    if (!item) return;
                    
                    // Calculate new price based on margin: price = cost / (1 - margin/100)
                    const newPrice = item.cost / (1 - margin / 100);
                    
                    fetch(`/api/menu/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            name: item.name,
                            price: newPrice,
                            cost: item.cost,
                            recipe_type: item.recipe_type,
                            portions: item.portions
                        })
                    }).then(() => {
                        loadMenu();
                    });
                });
        }
        
        let editingRecipeId = null;
        let editIngredients = [];
        
        function addEditIngredient() {
            editIngredients.push({ ingredientId: '', name: '', amount: '1', unit: '', calculatedCost: 0 });
            refreshEditIngredients();
        }
        
        function updateEditIngredient(index, field, value) {
            if (editIngredients[index]) {
                if (field === 'amount') {
                    editIngredients[index][field] = parseFloat(value) || 0;
                } else if (field === 'ingredientId') {
                    editIngredients[index][field] = value;
                    // Update name, unit, and servings from selected ingredient
                    fetch('/api/ingredients')
                        .then(r => r.json())
                        .then(ingredients => {
                            const ingredient = ingredients.find(ing => ing.id == value);
                            if (ingredient) {
                                editIngredients[index].name = ingredient.name;
                                editIngredients[index].unit = ingredient.unit;
                                editIngredients[index].unitCost = ingredient.cost;
                                editIngredients[index].servings = ingredient.servings || 1;
                                refreshEditIngredients();
                            }
                        });
                } else {
                    editIngredients[index][field] = value;
                }
            }
        }
        
        function calculateIngredientCost(index) {
            if (editIngredients[index] && editIngredients[index].unitCost && editIngredients[index].amount && editIngredients[index].servings) {
                // Calculate cost per serving, then multiply by amount of servings needed
                const costPerServing = editIngredients[index].unitCost / editIngredients[index].servings;
                editIngredients[index].calculatedCost = parseFloat((costPerServing * editIngredients[index].amount).toFixed(2));
                updateTotalCost();
                refreshEditIngredients();
            }
        }
        
        function updateTotalCost() {
            let sum = 0;
            editIngredients.forEach(ing => {
                sum += Math.round((ing.calculatedCost || 0) * 100);
            });
            const totalCost = sum / 100;
            const totalCostElement = document.getElementById('totalCost');
            const costInput = document.getElementById('cost');
            if (totalCostElement) {
                totalCostElement.textContent = totalCost.toFixed(2);
            }
            if (costInput) {
                costInput.value = totalCost.toFixed(2);
            }
        }
        
        function removeEditIngredient(index) {
            editIngredients.splice(index, 1);
            updateTotalCost();
            refreshEditIngredients();
        }
        
        function refreshEditIngredients() {
            // Load ingredients for dropdowns
            fetch('/api/ingredients')
                .then(r => r.json())
                .then(ingredients => {
                    const editList = document.getElementById('editIngredientsList');
                    if (editList) {
                        editList.innerHTML = editIngredients.map((ing, index) => `
                            <div class="form-row" style="align-items: center; margin-bottom: 10px;">
                                <select onchange="updateEditIngredient(${index}, 'ingredientId', this.value); calculateIngredientCost(${index})" style="flex: 1;">
                                    <option value="">Select ingredient...</option>
                                    ${ingredients.map(ingredient => `<option value="${ingredient.id}" ${ingredient.id == ing.ingredientId ? 'selected' : ''}>${ingredient.name} (${ingredient.servings || 1} servings per ${ingredient.unit})</option>`).join('')}
                                </select>
                                <input type="number" placeholder="Servings" step="0.1" value="${ing.amount}" onchange="updateEditIngredient(${index}, 'amount', this.value); calculateIngredientCost(${index})" style="width: 80px;">
                                <span style="width: 80px; text-align: center; font-size: 12px;">$${(ing.calculatedCost || 0).toFixed(2)}</span>
                                <button type="button" onclick="removeEditIngredient(${index})" style="background: var(--danger); color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer;">&times;</button>
                            </div>
                        `).join('');
                    }
                });
        }

        // Ingredient Functions
        function addIngredient() {
            const name = document.getElementById('ingredientName').value;
            const cost = parseFloat(document.getElementById('ingredientCost').value);
            const unit = document.getElementById('ingredientUnit').value;
            const servings = parseInt(document.getElementById('ingredientServings').value) || 1;

            if (!name || !cost || !unit) {
                alert('Please fill in all fields');
                return;
            }

            fetch('/api/ingredients', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, cost, unit, servings })
            }).then(() => {
                document.getElementById('ingredientName').value = '';
                document.getElementById('ingredientCost').value = '';
                document.getElementById('ingredientUnit').value = '';
                document.getElementById('ingredientServings').value = '';
                loadIngredients();
            });
        }

        function loadIngredients() {
            fetch('/api/ingredients')
                .then(r => r.json())
                .then(items => {
                    document.getElementById('ingredientsList').innerHTML = items.map(item => `
                        <div class="card">
                            <div class="card-title">${item.name}</div>
                            <div class="card-meta">Cost: $${item.cost} per ${item.unit}</div>
                            <div class="card-meta">Servings: ${item.servings || 1} per ${item.unit}</div>
                            <div class="card-meta">Cost per serving: $${((item.cost || 0) / (item.servings || 1)).toFixed(2)}</div>
                            <div class="card-actions">
                                <button class="btn" onclick="editIngredient(${item.id})" style="background: var(--orange); color: white;">Edit</button>
                                <button class="btn btn-danger" onclick="deleteIngredient(${item.id})">Delete</button>
                            </div>
                        </div>
                    `).join('');
                    
                    // Update inventory dropdown if it exists
                    const inventorySelect = document.getElementById('inventoryIngredient');
                    if (inventorySelect) {
                        inventorySelect.innerHTML = 
                            '<option value="">Select ingredient...</option>' +
                            items.map(ing => `<option value="${ing.id}">${ing.name} (${ing.unit})</option>`).join('');
                    }
                });
        }

        function editIngredient(id) {
            fetch('/api/ingredients')
                .then(r => r.json())
                .then(items => {
                    const ingredient = items.find(item => item.id === id);
                    if (!ingredient) return;
                    
                    const modal = document.getElementById('addModal');
                    const modalTitle = document.getElementById('modalTitle');
                    const modalForm = document.getElementById('modalForm');
                    
                    modalTitle.textContent = 'Edit Ingredient';
                    const units = getAllMeasurementUnits();
                    const unitOptions = units.map(unit => `<option value="${unit}" ${unit === ingredient.unit ? 'selected' : ''}>${unit}</option>`).join('');
                    
                    modalForm.innerHTML = `
                        <div class="form">
                            <div class="form-group">
                                <input type="text" id="ingredientName" placeholder="Ingredient Name" value="${ingredient.name}">
                            </div>
                            <div class="form-row">
                                <input type="number" id="ingredientCost" placeholder="Cost per Unit ($)" step="0.01" value="${ingredient.cost}">
                                <select id="ingredientUnit">
                                    <option value="">Select unit...</option>
                                    ${unitOptions}
                                </select>
                            </div>
                            <div class="form-group">
                                <input type="number" id="ingredientServings" placeholder="Servings" min="1" value="${ingredient.servings || 1}">
                            </div>
                            <button class="btn" onclick="updateIngredient(${id}); closeAddModal();">Update Ingredient</button>
                        </div>
                    `;
                    
                    modal.classList.add('show');
                });
        }
        
        function updateIngredient(id) {
            const name = document.getElementById('ingredientName').value;
            const cost = parseFloat(document.getElementById('ingredientCost').value);
            const unit = document.getElementById('ingredientUnit').value;
            const servings = parseInt(document.getElementById('ingredientServings').value) || 1;

            if (!name || !cost || !unit) {
                alert('Please fill in all fields');
                return;
            }

            fetch(`/api/ingredients/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, cost, unit, servings })
            }).then(() => {
                loadIngredients();
            });
        }

        function deleteIngredient(id) {
            if (confirm('Delete this ingredient?')) {
                fetch(`/api/ingredients/${id}`, { method: 'DELETE' })
                    .then(() => loadIngredients());
            }
        }

        // Inventory Functions
        function addInventoryItem() {
            const itemName = document.getElementById('inventoryItemName').value.trim();
            const category = document.getElementById('inventoryCategory').value;
            const unit = document.getElementById('inventoryUnit').value.trim();
            const currentStock = parseFloat(document.getElementById('currentStock').value) || 0;
            const minStock = parseFloat(document.getElementById('minStock').value) || 0;

            if (!itemName || !unit) {
                alert('Please enter item name and unit');
                return;
            }

            fetch('/api/inventory', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: itemName, unit: unit, category: category, current_stock: currentStock, min_stock: minStock, max_stock: 100 })
            }).then(() => {
                document.getElementById('inventoryItemName').value = '';
                document.getElementById('inventoryUnit').value = '';
                document.getElementById('currentStock').value = '';
                document.getElementById('minStock').value = '';
                loadInventory();
            });
        }

        function loadInventory() {
            fetch('/api/inventory')
                .then(r => r.json())
                .then(items => {
                    document.getElementById('inventoryList').innerHTML = items.map(item => {
                        const status = item.current_stock <= item.min_stock ? 'üî¥ Low Stock' : 'üü¢ Good';
                        return `
                            <div class="card">
                                <div class="card-title">${item.name}</div>
                                <div class="card-meta">${status}</div>
                                <div class="card-meta">Stock: ${item.current_stock} / ${item.min_stock} min ${item.unit}</div>
                                <div class="card-actions">
                                    <button class="btn" onclick="editInventoryItem(${item.ingredient_id})" style="background: var(--orange); color: white;">Edit</button>
                                    <button class="btn btn-danger" onclick="deleteInventoryItem(${item.ingredient_id})">Delete</button>
                                </div>
                            </div>
                        `;
                    }).join('');
                });
        }

        function editInventoryItem(id) {
            fetch('/api/inventory')
                .then(r => r.json())
                .then(items => {
                    const item = items.find(inv => inv.ingredient_id === id);
                    if (!item) return;
                    
                    const modal = document.getElementById('addModal');
                    const modalTitle = document.getElementById('modalTitle');
                    const modalForm = document.getElementById('modalForm');
                    
                    modalTitle.textContent = 'Edit Inventory';
                    modalForm.innerHTML = `
                        <div class="form">
                            <div class="form-group">
                                <input type="text" value="${item.name}" disabled style="background: var(--gray-light);">
                            </div>
                            <div class="form-row">
                                <input type="number" id="currentStock" placeholder="Current Stock" step="0.1" value="${item.current_stock}">
                                <input type="number" id="minStock" placeholder="Min Stock" step="0.1" value="${item.min_stock}">
                            </div>
                            <div class="form-group">
                                <input type="number" id="maxStock" placeholder="Max Stock" step="0.1" value="${item.max_stock}">
                            </div>
                            <button class="btn" onclick="updateInventoryItem(${id}); closeAddModal();">Update Inventory</button>
                        </div>
                    `;
                    
                    modal.classList.add('show');
                });
        }
        
        function updateInventoryItem(id) {
            const currentStock = parseFloat(document.getElementById('currentStock').value) || 0;
            const minStock = parseFloat(document.getElementById('minStock').value) || 5;
            const maxStock = parseFloat(document.getElementById('maxStock').value) || 100;

            fetch(`/api/inventory/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ current_stock: currentStock, min_stock: minStock, max_stock: maxStock })
            }).then(() => {
                loadInventory();
            });
        }

        function deleteInventoryItem(id) {
            if (confirm('Delete this inventory item?')) {
                fetch(`/api/inventory/${id}`, { method: 'DELETE' })
                    .then(() => loadInventory());
            }
        }

        // Supplier Functions
        function addSupplier() {
            const name = document.getElementById('supplierName').value;
            const contact = document.getElementById('supplierContact').value;
            const phone = document.getElementById('supplierPhone').value;
            const email = document.getElementById('supplierEmail').value;
            const address = document.getElementById('supplierAddress').value;
            const category = document.getElementById('supplierCategory').value;
            const description = document.getElementById('supplierDescription').value;

            if (!name) {
                alert('Please enter supplier name');
                return;
            }

            fetch('/api/suppliers', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, contact, phone, email, address, category, description })
            }).then(() => {
                document.getElementById('supplierName').value = '';
                document.getElementById('supplierContact').value = '';
                document.getElementById('supplierPhone').value = '';
                document.getElementById('supplierEmail').value = '';
                document.getElementById('supplierAddress').value = '';
                document.getElementById('supplierDescription').value = '';
                loadSuppliers();
            });
        }

        function loadSuppliers() {
            fetch('/api/suppliers')
                .then(r => r.json())
                .then(items => {
                    document.getElementById('suppliersList').innerHTML = items.map(item => `
                        <div class="card">
                            <div class="card-header" onclick="toggleSupplierDetails(${item.id})" style="cursor: pointer;">
                                <div class="card-title" style="display: flex; justify-content: space-between; align-items: center;">
                                    ${item.name}
                                    <span class="expand-icon" id="supplier-icon-${item.id}">‚ñº</span>
                                </div>
                                <div class="card-meta">${item.category || 'Food'}</div>
                            </div>
                            <div class="card-details" id="supplier-details-${item.id}" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border);">
                                <div class="card-meta">Contact: ${item.contact || 'No contact'}</div>
                                <div class="card-meta">Phone: ${item.phone || 'No phone'}</div>
                                <div class="card-meta">Email: ${item.email || 'No email'}</div>
                                ${item.address ? `<div class="card-meta">Address: ${item.address}</div>` : ''}
                                ${item.description ? `<div class="card-meta">Description: ${item.description}</div>` : ''}
                            </div>
                            <div class="card-actions">
                                <button class="btn" onclick="editSupplier(${item.id})" style="background: var(--orange); color: white;">Edit</button>
                                <button class="btn btn-danger" onclick="deleteSupplier(${item.id})">Delete</button>
                            </div>
                        </div>
                    `).join('');
                });
        }

        function editSupplier(id) {
            fetch('/api/suppliers')
                .then(r => r.json())
                .then(items => {
                    const supplier = items.find(item => item.id === id);
                    if (!supplier) return;
                    
                    const modal = document.getElementById('addModal');
                    const modalTitle = document.getElementById('modalTitle');
                    const modalForm = document.getElementById('modalForm');
                    
                    modalTitle.textContent = 'Edit Supplier';
                    modalForm.innerHTML = `
                        <div class="form">
                            <div class="form-group">
                                <input type="text" id="supplierName" placeholder="Supplier Name" value="${supplier.name}">
                            </div>
                            <div class="form-row">
                                <input type="text" id="supplierContact" placeholder="Contact Person" value="${supplier.contact || ''}">
                                <select id="supplierCategory">
                                    ${getAllSupplierCategories().map(cat => `<option value="${cat}" ${supplier.category === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-row">
                                <input type="tel" id="supplierPhone" placeholder="Phone Number" value="${supplier.phone || ''}">
                                <input type="email" id="supplierEmail" placeholder="Email" value="${supplier.email || ''}">
                            </div>
                            <div class="form-group">
                                <input type="text" id="supplierAddress" placeholder="Address" value="${supplier.address || ''}">
                            </div>
                            <div class="form-group">
                                <textarea id="supplierDescription" placeholder="Description, notes, terms..." rows="3">${supplier.description || ''}</textarea>
                            </div>
                            <button class="btn" onclick="updateSupplier(${id}); closeAddModal();">Update Supplier</button>
                        </div>
                    `;
                    
                    modal.classList.add('show');
                });
        }
        
        function updateSupplier(id) {
            const name = document.getElementById('supplierName').value;
            const contact = document.getElementById('supplierContact').value;
            const phone = document.getElementById('supplierPhone').value;
            const email = document.getElementById('supplierEmail').value;
            const address = document.getElementById('supplierAddress').value;
            const category = document.getElementById('supplierCategory').value;
            const description = document.getElementById('supplierDescription').value;

            if (!name) {
                alert('Please enter supplier name');
                return;
            }

            fetch(`/api/suppliers/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, contact, phone, email, address, category, description })
            }).then(() => {
                loadSuppliers();
            });
        }

        function deleteSupplier(id) {
            if (confirm('Delete this supplier?')) {
                fetch(`/api/suppliers/${id}`, { method: 'DELETE' })
                    .then(() => loadSuppliers());
            }
        }
        
        function toggleSupplierDetails(id) {
            const details = document.getElementById(`supplier-details-${id}`);
            const icon = document.getElementById(`supplier-icon-${id}`);
            
            if (details.style.display === 'none') {
                details.style.display = 'block';
                icon.textContent = '‚ñ≤';
            } else {
                details.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }

        // Tools Functions
        function addTool() {
            const name = document.getElementById('toolName').value;
            const category = document.getElementById('toolCategory').value;
            const status = document.getElementById('toolStatus').value;
            
            if (!name) {
                alert('Please enter tool name');
                return;
            }
            
            const tools = JSON.parse(localStorage.getItem('tools') || '[]');
            tools.push({ id: Date.now(), name, category, status });
            localStorage.setItem('tools', JSON.stringify(tools));
            
            document.getElementById('toolName').value = '';
            loadTools();
        }
        
        function loadTools() {
            const tools = JSON.parse(localStorage.getItem('tools') || '[]');
            document.getElementById('toolsList').innerHTML = tools.map(tool => `
                <div class="card">
                    <div class="card-title">${tool.name}</div>
                    <div class="card-meta">${tool.category} ‚Ä¢ ${tool.status}</div>
                    <div class="card-actions">
                        <button class="btn btn-danger" onclick="deleteTool(${tool.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        function deleteTool(id) {
            if (confirm('Delete this tool?')) {
                const tools = JSON.parse(localStorage.getItem('tools') || '[]');
                const filtered = tools.filter(t => t.id !== id);
                localStorage.setItem('tools', JSON.stringify(filtered));
                loadTools();
            }
        }
        
        // File Upload Functions
        function uploadFile() {
            const fileInput = document.getElementById('fileUpload');
            const files = fileInput.files;
            
            if (files.length === 0) {
                alert('Please select files to upload');
                return;
            }
            
            for (let file of files) {
                const formData = new FormData();
                formData.append('file', file);
                
                fetch('/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    const uploadedFiles = JSON.parse(localStorage.getItem('uploadedFiles') || '[]');
                    uploadedFiles.push({
                        id: Date.now() + Math.random(),
                        name: file.name,
                        path: data.path,
                        size: file.size,
                        type: file.type,
                        uploadDate: new Date().toLocaleDateString()
                    });
                    localStorage.setItem('uploadedFiles', JSON.stringify(uploadedFiles));
                    loadFiles();
                })
                .catch(error => {
                    console.error('Upload error:', error);
                    alert('Upload failed');
                });
            }
            
            fileInput.value = '';
        }
        
        function uploadFileFromSection() {
            const fileInput = document.getElementById('fileUpload');
            const files = fileInput.files;
            
            if (files.length === 0) return;
            
            for (let file of files) {
                const formData = new FormData();
                formData.append('file', file);
                
                fetch('/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    const uploadedFiles = JSON.parse(localStorage.getItem('uploadedFiles') || '[]');
                    uploadedFiles.push({
                        id: Date.now() + Math.random(),
                        name: file.name,
                        path: data.path,
                        size: file.size,
                        type: file.type,
                        uploadDate: new Date().toLocaleDateString()
                    });
                    localStorage.setItem('uploadedFiles', JSON.stringify(uploadedFiles));
                    loadFiles();
                })
                .catch(error => {
                    console.error('Upload error:', error);
                    alert('Upload failed');
                });
            }
            
            fileInput.value = '';
        }
        
        function loadFiles() {
            // Get files from localStorage
            const storedFiles = JSON.parse(localStorage.getItem('uploadedFiles') || '[]');
            
            // Get actual files from server
            fetch('/api/files')
                .then(r => r.json())
                .catch(() => {
                    // If API doesn't exist, show localStorage files only
                    const existingFiles = [
                        {
                            id: 1,
                            name: 'birria-fusion-logo.png',
                            path: '/uploads/1763192867406_birria-fusion-logo.png',
                            size: 0,
                            type: 'image/png',
                            uploadDate: 'Previously uploaded'
                        }
                    ];
                    
                    const allFiles = [...existingFiles, ...storedFiles];
                    displayFiles(allFiles);
                });
        }
        
        function displayFiles(files) {
            document.getElementById('filesList').innerHTML = files.map(file => {
                const isImage = file.type && file.type.startsWith('image/');
                const thumbnail = isImage ? 
                    `<img src="${file.path}" class="file-thumbnail">` : 
                    `<div class="file-icon">${file.name.split('.').pop().toUpperCase()}</div>`;
                
                return `
                    <div class="file-card">
                        ${thumbnail}
                        <div class="file-name">${file.name}</div>
                        <div class="file-meta">${file.size > 0 ? `${(file.size / 1024).toFixed(1)} KB` : 'Logo'}</div>
                        <div class="file-actions">
                            <button class="btn" onclick="viewFile('${file.path}')" style="background: #ff6b35; color: white;">View</button>
                            ${file.id !== 1 ? `<button class="btn btn-danger" onclick="deleteFile(${file.id})">Del</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function viewFile(path) {
            window.open(path, '_blank');
        }
        
        function deleteFile(id) {
            if (confirm('Delete this file?')) {
                const files = JSON.parse(localStorage.getItem('uploadedFiles') || '[]');
                const filtered = files.filter(f => f.id !== id);
                localStorage.setItem('uploadedFiles', JSON.stringify(filtered));
                loadFiles();
            }
        }
        
        // Catering Functions
        function addCateringOrder() {
            const client = document.getElementById('cateringClient').value;
            const date = document.getElementById('cateringDate').value;
            const guests = document.getElementById('cateringGuests').value;
            const price = document.getElementById('cateringPrice').value;
            
            if (!client || !date || !guests) {
                alert('Please fill in required fields');
                return;
            }
            
            const orders = JSON.parse(localStorage.getItem('catering') || '[]');
            orders.push({ id: Date.now(), client, date, guests, price });
            localStorage.setItem('catering', JSON.stringify(orders));
            
            document.getElementById('cateringClient').value = '';
            document.getElementById('cateringDate').value = '';
            document.getElementById('cateringGuests').value = '';
            document.getElementById('cateringPrice').value = '';
            loadCatering();
        }
        
        function loadCatering() {
            const orders = JSON.parse(localStorage.getItem('catering') || '[]');
            document.getElementById('cateringList').innerHTML = orders.map(order => `
                <div class="card">
                    <div class="card-title">${order.client}</div>
                    <div class="card-meta">${order.date} ‚Ä¢ ${order.guests} guests</div>
                    <div class="card-meta">$${order.price || 'TBD'}</div>
                    <div class="card-actions">
                        <button class="btn" onclick="editCateringOrder(${order.id})" style="background: var(--orange); color: white;">Edit</button>
                        <button class="btn btn-danger" onclick="deleteCateringOrder(${order.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        function editCateringOrder(id) {
            const orders = JSON.parse(localStorage.getItem('catering') || '[]');
            const order = orders.find(o => o.id === id);
            if (!order) return;
            
            const modal = document.getElementById('addModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalForm = document.getElementById('modalForm');
            
            modalTitle.textContent = 'Edit Catering Order';
            modalForm.innerHTML = `
                <div class="form">
                    <div class="form-row">
                        <input type="text" id="cateringClient" placeholder="Client Name" value="${order.client}">
                        <input type="date" id="cateringDate" value="${order.date}">
                    </div>
                    <div class="form-row">
                        <input type="number" id="cateringGuests" placeholder="Number of Guests" min="1" value="${order.guests}">
                        <input type="number" id="cateringPrice" placeholder="Total Price ($)" step="0.01" value="${order.price || ''}">
                    </div>
                    <button class="btn" onclick="updateCateringOrder(${id}); closeAddModal();">Update Catering Order</button>
                </div>
            `;
            
            modal.classList.add('show');
        }
        
        function updateCateringOrder(id) {
            const client = document.getElementById('cateringClient').value;
            const date = document.getElementById('cateringDate').value;
            const guests = document.getElementById('cateringGuests').value;
            const price = document.getElementById('cateringPrice').value;
            
            if (!client || !date || !guests) {
                alert('Please fill in required fields');
                return;
            }
            
            const orders = JSON.parse(localStorage.getItem('catering') || '[]');
            const orderIndex = orders.findIndex(o => o.id === id);
            if (orderIndex !== -1) {
                orders[orderIndex] = { id, client, date, guests, price };
                localStorage.setItem('catering', JSON.stringify(orders));
                loadCatering();
            }
        }

        function deleteCateringOrder(id) {
            if (confirm('Delete this catering order?')) {
                const orders = JSON.parse(localStorage.getItem('catering') || '[]');
                const filtered = orders.filter(o => o.id !== id);
                localStorage.setItem('catering', JSON.stringify(filtered));
                loadCatering();
            }
        }
        
        // Analytics Functions
        function loadAnalytics() {
            fetch('/api/menu')
                .then(r => r.json())
                .then(items => {
                    const totalItems = items.length;
                    const defaultMargin = parseFloat(localStorage.getItem('defaultMargin') || '30');
                    const goodItems = items.filter(item => ((item.price - item.cost) / item.price) * 100 >= defaultMargin).length;
                    const needsAttention = items.filter(item => {
                        const margin = ((item.price - item.cost) / item.price) * 100;
                        return margin >= (defaultMargin * 0.67) && margin < defaultMargin;
                    }).length;
                    const badItems = items.filter(item => ((item.price - item.cost) / item.price) * 100 < (defaultMargin * 0.67)).length;
                    
                    document.getElementById('analyticsStats').innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--success)">${goodItems}</div>
                            <div class="stat-label">Good Items (30%+)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--warning)">${needsAttention}</div>
                            <div class="stat-label">Needs Attention (20-29%)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--danger)">${badItems}</div>
                            <div class="stat-label">Bad Items (<20%)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${totalItems}</div>
                            <div class="stat-label">Total Items</div>
                        </div>
                    `;
                    
                    document.getElementById('foodCostAnalysis').innerHTML = items.map(item => {
                        const foodCost = (item.cost / item.price) * 100;
                        const defaultMargin = parseFloat(localStorage.getItem('defaultMargin') || '30');
                        const margin = ((item.price - item.cost) / item.price) * 100;
                        const status = margin >= defaultMargin ? 'Good' : margin >= (defaultMargin * 0.67) ? 'Needs Attention' : 'Bad - Urgent';
                        const color = margin >= defaultMargin ? 'var(--success)' : margin >= (defaultMargin * 0.67) ? 'var(--warning)' : 'var(--danger)';
                        return `
                            <div class="card">
                                <div class="card-title">${item.name}</div>
                                <div class="card-meta">Food Cost: <span style="color: ${color}">${foodCost.toFixed(1)}%</span></div>
                                <div class="card-meta">Status: <span style="color: ${color}">${status}</span></div>
                                <div class="card-meta">Price: $${item.price} ‚Ä¢ Cost: $${item.cost}</div>
                            </div>
                        `;
                    }).join('');
                });
        }

        // Theme Functions
        function toggleTheme() {
            const isDark = document.getElementById('darkMode').checked;
            document.body.setAttribute('data-theme', isDark ? 'dark' : 'light');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            document.getElementById('darkMode').checked = savedTheme === 'dark';
        }

        // Menu Categories Functions
        function addMenuCategory() {
            const category = document.getElementById('newCategory').value.trim();
            if (!category) {
                alert('Please enter a category name');
                return;
            }
            
            const categories = JSON.parse(localStorage.getItem('menuCategories') || '[]');
            if (!categories.includes(category)) {
                categories.push(category);
                localStorage.setItem('menuCategories', JSON.stringify(categories));
                document.getElementById('newCategory').value = '';
                loadMenuCategories();
            } else {
                alert('Category already exists');
            }
        }
        
        function loadMenuCategories() {
            const categories = JSON.parse(localStorage.getItem('menuCategories') || '["Entree","Appetizer","Dessert","Sauce","Side","Beverage"]');
            
            document.getElementById('categoriesList').innerHTML = categories.map(category => `
                <span onclick="editMenuCategory('${category}')" style="display: inline-block; background: var(--orange); color: white; padding: 5px 10px; margin: 2px; border-radius: 15px; font-size: 12px; cursor: pointer;">
                    ${category}
                </span>
            `).join('');
        }
        
        let editType = '';
        let editOriginalValue = '';
        
        function editMenuCategory(category) {
            editType = 'category';
            editOriginalValue = category;
            document.getElementById('editModalTitle').textContent = 'Edit Category';
            document.getElementById('editInput').value = category;
            document.getElementById('editModal').classList.add('show');
        }
        
        function deleteMenuCategory(category) {
            if (confirm(`Delete category "${category}"?`)) {
                const categories = JSON.parse(localStorage.getItem('menuCategories') || '["Entree","Appetizer","Dessert","Sauce","Side","Beverage"]');
                const filtered = categories.filter(c => c !== category);
                localStorage.setItem('menuCategories', JSON.stringify(filtered));
                loadMenuCategories();
            }
        }
        
        function getAllMenuCategories() {
            return JSON.parse(localStorage.getItem('menuCategories') || '["Entree","Appetizer","Dessert","Sauce","Side","Beverage"]');
        }

        // Supplier Categories Functions
        function addSupplierCategory() {
            const category = document.getElementById('newSupplierCategory').value.trim();
            if (!category) {
                alert('Please enter a category name');
                return;
            }
            
            const categories = JSON.parse(localStorage.getItem('supplierCategories') || '[]');
            if (!categories.includes(category)) {
                categories.push(category);
                localStorage.setItem('supplierCategories', JSON.stringify(categories));
                document.getElementById('newSupplierCategory').value = '';
                loadSupplierCategories();
            } else {
                alert('Category already exists');
            }
        }
        
        function loadSupplierCategories() {
            const categories = JSON.parse(localStorage.getItem('supplierCategories') || '["Food","Equipment","Supplies","Other"]');
            
            document.getElementById('supplierCategoriesList').innerHTML = categories.map(category => `
                <span onclick="editSupplierCategory('${category}')" style="display: inline-block; background: var(--orange); color: white; padding: 5px 10px; margin: 2px; border-radius: 15px; font-size: 12px; cursor: pointer;">
                    ${category}
                </span>
            `).join('');
        }
        
        function editSupplierCategory(category) {
            editType = 'supplierCategory';
            editOriginalValue = category;
            document.getElementById('editModalTitle').textContent = 'Edit Supplier Category';
            document.getElementById('editInput').value = category;
            document.getElementById('editModal').classList.add('show');
        }
        
        function getAllSupplierCategories() {
            return JSON.parse(localStorage.getItem('supplierCategories') || '["Food","Equipment","Supplies","Other"]');
        }

        // Measurement Units Functions
        function addMeasurementUnit() {
            const unit = document.getElementById('newUnit').value.trim();
            if (!unit) {
                alert('Please enter a unit name');
                return;
            }
            
            const units = JSON.parse(localStorage.getItem('measurementUnits') || '["lb","oz","kg","g","cups","tbsp","tsp","liters","ml","pieces","pack"]');
            if (!units.includes(unit)) {
                units.push(unit);
                localStorage.setItem('measurementUnits', JSON.stringify(units));
                document.getElementById('newUnit').value = '';
                loadMeasurementUnits();
            } else {
                alert('Unit already exists');
            }
        }
        
        function loadMeasurementUnits() {
            const units = JSON.parse(localStorage.getItem('measurementUnits') || '["lb","oz","kg","g","cups","tbsp","tsp","liters","ml","pieces","pack"]');
            
            document.getElementById('unitsList').innerHTML = units.map(unit => `
                <span onclick="editMeasurementUnit('${unit}')" style="display: inline-block; background: var(--orange); color: white; padding: 5px 10px; margin: 2px; border-radius: 15px; font-size: 12px; cursor: pointer;">
                    ${unit}
                </span>
            `).join('');
        }
        
        function editMeasurementUnit(unit) {
            editType = 'unit';
            editOriginalValue = unit;
            document.getElementById('editModalTitle').textContent = 'Edit Unit';
            document.getElementById('editInput').value = unit;
            document.getElementById('editModal').classList.add('show');
        }
        
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
        }
        
        function saveEdit() {
            const newValue = document.getElementById('editInput').value.trim();
            if (!newValue) return;
            
            if (editType === 'category') {
                const categories = JSON.parse(localStorage.getItem('menuCategories') || '["Entree","Appetizer","Dessert","Sauce","Side","Beverage"]');
                const index = categories.indexOf(editOriginalValue);
                if (index !== -1) {
                    categories[index] = newValue;
                    localStorage.setItem('menuCategories', JSON.stringify(categories));
                    loadMenuCategories();
                }
            } else if (editType === 'unit') {
                const units = JSON.parse(localStorage.getItem('measurementUnits') || '["lb","oz","kg","g","cups","tbsp","tsp","liters","ml","pieces","pack"]');
                const index = units.indexOf(editOriginalValue);
                if (index !== -1) {
                    units[index] = newValue;
                    localStorage.setItem('measurementUnits', JSON.stringify(units));
                    loadMeasurementUnits();
                }
            } else if (editType === 'supplierCategory') {
                const categories = JSON.parse(localStorage.getItem('supplierCategories') || '["Food","Equipment","Supplies","Other"]');
                const index = categories.indexOf(editOriginalValue);
                if (index !== -1) {
                    categories[index] = newValue;
                    localStorage.setItem('supplierCategories', JSON.stringify(categories));
                    loadSupplierCategories();
                }
            }
            closeEditModal();
        }
        
        function deleteItem() {
            if (!confirm(`Delete "${editOriginalValue}"?`)) return;
            
            if (editType === 'category') {
                const categories = JSON.parse(localStorage.getItem('menuCategories') || '["Entree","Appetizer","Dessert","Sauce","Side","Beverage"]');
                const filtered = categories.filter(c => c !== editOriginalValue);
                localStorage.setItem('menuCategories', JSON.stringify(filtered));
                loadMenuCategories();
            } else if (editType === 'unit') {
                const units = JSON.parse(localStorage.getItem('measurementUnits') || '["lb","oz","kg","g","cups","tbsp","tsp","liters","ml","pieces","pack"]');
                const filtered = units.filter(u => u !== editOriginalValue);
                localStorage.setItem('measurementUnits', JSON.stringify(filtered));
                loadMeasurementUnits();
            } else if (editType === 'supplierCategory') {
                const categories = JSON.parse(localStorage.getItem('supplierCategories') || '["Food","Equipment","Supplies","Other"]');
                const filtered = categories.filter(c => c !== editOriginalValue);
                localStorage.setItem('supplierCategories', JSON.stringify(filtered));
                loadSupplierCategories();
            }
            closeEditModal();
        }
        
        function deleteMeasurementUnit(unit) {
            if (confirm(`Delete unit "${unit}"?`)) {
                const units = JSON.parse(localStorage.getItem('measurementUnits') || '["lb","oz","kg","g","cups","tbsp","tsp","liters","ml","pieces","pack"]');
                const filtered = units.filter(u => u !== unit);
                localStorage.setItem('measurementUnits', JSON.stringify(filtered));
                loadMeasurementUnits();
            }
        }
        
        function getAllMeasurementUnits() {
            return JSON.parse(localStorage.getItem('measurementUnits') || '["lb","oz","kg","g","cups","tbsp","tsp","liters","ml","pieces","pack"]');
        }

        // Data Management Functions
        function exportData() {
            const data = {
                menu: [],
                ingredients: [],
                inventory: [],
                suppliers: [],
                tools: JSON.parse(localStorage.getItem('tools') || '[]'),
                catering: JSON.parse(localStorage.getItem('catering') || '[]'),
                measurementUnits: JSON.parse(localStorage.getItem('measurementUnits') || '[]'),
                uploadedFiles: JSON.parse(localStorage.getItem('uploadedFiles') || '[]'),
                exportDate: new Date().toISOString()
            };
            
            // Get database data
            Promise.all([
                fetch('/api/menu').then(r => r.json()),
                fetch('/api/ingredients').then(r => r.json()),
                fetch('/api/inventory').then(r => r.json()),
                fetch('/api/suppliers').then(r => r.json())
            ]).then(([menu, ingredients, inventory, suppliers]) => {
                data.menu = menu;
                data.ingredients = ingredients;
                data.inventory = inventory;
                data.suppliers = suppliers;
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `birria-fusion-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }).catch(error => {
                console.error('Export error:', error);
                alert('Export failed');
            });
        }

        // Settings Functions
        function toggleSettingsSection(section) {
            const content = document.getElementById(`${section}-content`);
            const icon = document.getElementById(`${section}-icon`);
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                icon.textContent = '‚ñº';
            } else {
                content.classList.add('show');
                icon.textContent = '‚ñ≤';
            }
        }
        
        function saveDefaultMargin() {
            const margin = document.getElementById('defaultMargin').value;
            if (margin) {
                localStorage.setItem('defaultMargin', margin);
            }
        }
        
        function loadDefaultMargin() {
            const margin = localStorage.getItem('defaultMargin') || '30';
            document.getElementById('defaultMargin').value = margin;
        }
        
        function clearData() {
            if (confirm('This will delete ALL data. Are you sure?')) {
                localStorage.clear();
                alert('Data cleared! Please refresh the page.');
            }
        }

        // License Functions
        function addLicense() {
            const modal = document.getElementById('addModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalForm = document.getElementById('modalForm');
            
            modalTitle.textContent = 'Add License/Permit';
            modalForm.innerHTML = `
                <div class="form">
                    <div class="form-group">
                        <select id="licenseType">
                            <option value="Business License">Business License</option>
                            <option value="Food Handler's Permit">Food Handler's Permit</option>
                            <option value="Mobile Vendor Permit">Mobile Vendor Permit</option>
                            <option value="Health Department Permit">Health Department Permit</option>
                            <option value="Fire Department Permit">Fire Department Permit</option>
                            <option value="State Sales Tax License">State Sales Tax License</option>
                            <option value="Workers Compensation">Workers Compensation</option>
                            <option value="General Liability Insurance">General Liability Insurance</option>
                            <option value="Vehicle Registration">Vehicle Registration</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group" id="customNameField" style="display: none;">
                        <input type="text" id="customLicenseName" placeholder="Enter license name">
                    </div>
                    <div class="form-row">
                        <input type="text" id="licenseNumber" placeholder="License/Permit Number">
                        <input type="text" id="issuingAgency" placeholder="Issuing Agency">
                    </div>
                    <div class="form-row">
                        <input type="text" id="expirationDate" placeholder="Expiration Date" onfocus="this.type='date'" onblur="if(!this.value)this.type='text'">
                        <input type="text" id="renewalCost" placeholder="Renewal Cost ($)">
                    </div>
                    <button class="btn" onclick="saveLicense(); closeAddModal();">Add License</button>
                </div>
            `;
            
            // Show custom name field when "Other" is selected
            setTimeout(() => {
                document.getElementById('licenseType').onchange = function() {
                    const customField = document.getElementById('customNameField');
                    customField.style.display = this.value === 'Other' ? 'block' : 'none';
                };
            }, 100);
            
            modal.classList.add('show');
        }
        
        function saveLicense() {
            const type = document.getElementById('licenseType').value;
            const customName = document.getElementById('customLicenseName')?.value;
            const name = type === 'Other' ? customName : type;
            const number = document.getElementById('licenseNumber').value;
            const agency = document.getElementById('issuingAgency').value;
            const expiration = document.getElementById('expirationDate').value;
            const cost = document.getElementById('renewalCost').value;
            
            if (!name || !expiration) {
                alert('Please enter license name and expiration date');
                return;
            }
            
            const licenses = JSON.parse(localStorage.getItem('licenses') || '[]');
            licenses.push({
                id: Date.now(),
                name,
                number,
                agency,
                expiration,
                cost
            });
            localStorage.setItem('licenses', JSON.stringify(licenses));
            loadLicenses();
        }
        
        function loadLicenses() {
            const licenses = JSON.parse(localStorage.getItem('licenses') || '[]');
            const today = new Date().toISOString().split('T')[0];
            
            document.getElementById('licenseList').innerHTML = licenses.map(license => {
                const expDate = new Date(license.expiration);
                const daysUntilExp = Math.ceil((expDate - new Date()) / (1000 * 60 * 60 * 24));
                
                let status, statusColor;
                if (daysUntilExp < 0) {
                    status = 'üî¥ EXPIRED';
                    statusColor = 'var(--danger)';
                } else if (daysUntilExp <= 30) {
                    status = 'üü° Expires Soon';
                    statusColor = 'var(--warning)';
                } else {
                    status = 'üü¢ Valid';
                    statusColor = 'var(--success)';
                }
                
                return `
                    <div class="file-card">
                        <div class="file-icon" style="background: ${statusColor}; font-size: 0.6em;">${license.name.slice(0,4).toUpperCase()}</div>
                        <div class="file-name">${license.name}</div>
                        <div class="file-meta">${license.agency || 'No agency'}</div>
                        <div class="file-meta">Expires: ${license.expiration}</div>
                        <div class="file-meta" style="color: ${statusColor}; font-weight: bold;">${status}</div>
                        <div class="file-actions">
                            <button class="btn" onclick="renewLicense(${license.id})" style="background: var(--orange); color: white;">Renew</button>
                            <button class="btn btn-danger" onclick="deleteLicense(${license.id})">Del</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renewLicense(id) {
            const licenses = JSON.parse(localStorage.getItem('licenses') || '[]');
            const license = licenses.find(l => l.id === id);
            if (!license) return;
            
            const newExpiration = prompt('Enter new expiration date (YYYY-MM-DD):', license.expiration);
            if (newExpiration && /^\d{4}-\d{2}-\d{2}$/.test(newExpiration)) {
                license.expiration = newExpiration;
                localStorage.setItem('licenses', JSON.stringify(licenses));
                loadLicenses();
            }
        }
        
        function deleteLicense(id) {
            if (confirm('Delete this license/permit?')) {
                const licenses = JSON.parse(localStorage.getItem('licenses') || '[]');
                const filtered = licenses.filter(l => l.id !== id);
                localStorage.setItem('licenses', JSON.stringify(filtered));
                loadLicenses();
            }
        }

        // Maintenance Functions
        function addMaintenanceTask() {
            const modal = document.getElementById('addModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalForm = document.getElementById('modalForm');
            
            modalTitle.textContent = 'Add Maintenance Task';
            modalForm.innerHTML = `
                <div class="form">
                    <div class="form-group">
                        <input type="text" id="taskName" placeholder="Task Name (e.g., Clean Fryer, Health Inspection)">
                    </div>
                    <div class="form-row">
                        <select id="taskType">
                            <option value="Equipment">Equipment Service</option>
                            <option value="Cleaning">Cleaning</option>
                            <option value="Inspection">Health Inspection</option>
                            <option value="Permit">Permit Renewal</option>
                        </select>
                        <select id="frequency">
                            <option value="Daily">Daily</option>
                            <option value="Weekly">Weekly</option>
                            <option value="Monthly">Monthly</option>
                            <option value="Quarterly">Quarterly</option>
                            <option value="Yearly">Yearly</option>
                            <option value="Once">One-time</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <input type="text" id="nextDue" placeholder="Next Due Date" onfocus="this.type='date'" onblur="if(!this.value)this.type='text'">
                        <input type="text" id="lastDone" placeholder="Last Completed" onfocus="this.type='date'" onblur="if(!this.value)this.type='text'">
                    </div>
                    <button class="btn" onclick="saveMaintenanceTask(); closeAddModal();">Add Task</button>
                </div>
            `;
            
            modal.classList.add('show');
        }
        
        function saveMaintenanceTask() {
            const name = document.getElementById('taskName').value;
            const type = document.getElementById('taskType').value;
            const frequency = document.getElementById('frequency').value;
            const nextDue = document.getElementById('nextDue').value;
            const lastDone = document.getElementById('lastDone').value;
            
            if (!name || !nextDue) {
                alert('Please enter task name and due date');
                return;
            }
            
            const tasks = JSON.parse(localStorage.getItem('maintenanceTasks') || '[]');
            tasks.push({
                id: Date.now(),
                name,
                type,
                frequency,
                nextDue,
                lastDone,
                completed: false
            });
            localStorage.setItem('maintenanceTasks', JSON.stringify(tasks));
            loadMaintenanceTasks();
        }
        
        function loadMaintenanceTasks() {
            const tasks = JSON.parse(localStorage.getItem('maintenanceTasks') || '[]');
            const today = new Date().toISOString().split('T')[0];
            
            document.getElementById('maintenanceList').innerHTML = tasks.map(task => {
                const isOverdue = task.nextDue < today;
                const isDueSoon = task.nextDue <= new Date(Date.now() + 7*24*60*60*1000).toISOString().split('T')[0];
                const status = isOverdue ? 'üî¥ Overdue' : isDueSoon ? 'üü° Due Soon' : 'üü¢ On Track';
                const statusColor = isOverdue ? 'var(--danger)' : isDueSoon ? 'var(--warning)' : 'var(--success)';
                
                return `
                    <div class="file-card">
                        <div class="file-icon" style="background: ${statusColor}; font-size: 0.7em;">${task.type.slice(0,3).toUpperCase()}</div>
                        <div class="file-name">${task.name}</div>
                        <div class="file-meta">${task.frequency} ‚Ä¢ Due: ${task.nextDue}</div>
                        <div class="file-meta" style="color: ${statusColor}; font-weight: bold;">${status}</div>
                        <div class="file-actions">
                            <button class="btn" onclick="completeTask(${task.id})" style="background: var(--success); color: white;">Done</button>
                            <button class="btn btn-danger" onclick="deleteMaintenanceTask(${task.id})">Del</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function completeTask(id) {
            const tasks = JSON.parse(localStorage.getItem('maintenanceTasks') || '[]');
            const task = tasks.find(t => t.id === id);
            if (!task) return;
            
            const today = new Date().toISOString().split('T')[0];
            task.lastDone = today;
            
            // Calculate next due date based on frequency
            const nextDate = new Date(today);
            switch(task.frequency) {
                case 'Daily': nextDate.setDate(nextDate.getDate() + 1); break;
                case 'Weekly': nextDate.setDate(nextDate.getDate() + 7); break;
                case 'Monthly': nextDate.setMonth(nextDate.getMonth() + 1); break;
                case 'Quarterly': nextDate.setMonth(nextDate.getMonth() + 3); break;
                case 'Yearly': nextDate.setFullYear(nextDate.getFullYear() + 1); break;
                case 'Once': 
                    tasks.splice(tasks.findIndex(t => t.id === id), 1);
                    localStorage.setItem('maintenanceTasks', JSON.stringify(tasks));
                    loadMaintenanceTasks();
                    return;
            }
            
            task.nextDue = nextDate.toISOString().split('T')[0];
            localStorage.setItem('maintenanceTasks', JSON.stringify(tasks));
            loadMaintenanceTasks();
        }
        
        function deleteMaintenanceTask(id) {
            if (confirm('Delete this maintenance task?')) {
                const tasks = JSON.parse(localStorage.getItem('maintenanceTasks') || '[]');
                const filtered = tasks.filter(t => t.id !== id);
                localStorage.setItem('maintenanceTasks', JSON.stringify(filtered));
                loadMaintenanceTasks();
            }
        }

        // QR Code Functions
        function updateQRPlaceholder() {
            const type = document.getElementById('qrType').value;
            const input = document.getElementById('qrContent');
            const wifiFields = document.getElementById('wifiFields');
            
            wifiFields.style.display = type === 'wifi' ? 'block' : 'none';
            
            const placeholders = {
                url: 'https://your-menu-website.com',
                text: 'Welcome to Birria Fusion!',
                phone: '+1-555-123-4567',
                email: 'info@birriafusion.com',
                wifi: 'Leave blank for WiFi'
            };
            
            input.placeholder = placeholders[type];
            if (type === 'wifi') input.style.display = 'none';
            else input.style.display = 'block';
        }
        
        function generateQR() {
            const type = document.getElementById('qrType').value;
            let content = '';
            
            if (type === 'wifi') {
                const ssid = document.getElementById('wifiSSID').value;
                const password = document.getElementById('wifiPassword').value;
                if (!ssid) {
                    alert('Please enter network name');
                    return;
                }
                content = `WIFI:T:WPA;S:${ssid};P:${password};;`;
            } else {
                content = document.getElementById('qrContent').value;
                if (!content) {
                    alert('Please enter content for QR code');
                    return;
                }
                
                if (type === 'phone') content = `tel:${content}`;
                if (type === 'email') content = `mailto:${content}`;
            }
            
            // Generate QR code using Google Charts API
            const size = '200x200';
            const qrUrl = `https://chart.googleapis.com/chart?cht=qr&chs=${size}&chl=${encodeURIComponent(content)}`;
            
            document.getElementById('qrResult').innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 12px; display: inline-block; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <img src="${qrUrl}" alt="QR Code" style="display: block; margin-bottom: 10px;">
                    <div style="font-size: 12px; color: var(--gray); margin-bottom: 10px; word-break: break-all;">${content}</div>
                    <button class="btn" onclick="downloadQR('${qrUrl}')" style="width: auto; padding: 8px 16px; font-size: 0.9em;">Download</button>
                </div>
            `;
        }
        
        function downloadQR(url) {
            const link = document.createElement('a');
            link.href = url;
            link.download = 'qr-code.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Initialize
        loadTheme();
        loadDashboard();
        loadIngredients();
        
        // Hide FAB on dashboard initially
        document.getElementById('fabBtn').style.display = 'none';
    </script>
</body>
</html>